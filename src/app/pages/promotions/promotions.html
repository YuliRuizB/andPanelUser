<div class="mx-auto max-w-6xl px-4 py-8">

    <!-- Tabs -->
    <div class="flex justify-center">
        <div class="inline-flex rounded-2xl bg-[#235000] p-1 text-white shadow-lg">

            <button class="px-8 py-3 rounded-xl text-sm font-semibold transition focus:outline-none" [ngClass]="tab === 'active'
        ? 'bg-[#9db091] text-white'
        : 'bg-transparent text-white hover:bg-white/10'" (click)="setTab('active')">
                Activas
            </button>

            <button class="px-8 py-3 rounded-xl text-sm font-semibold transition focus:outline-none" [ngClass]="tab === 'inactive'
        ? 'bg-[#9db091] text-white'
        : 'bg-transparent text-white hover:bg-white/10'" (click)="setTab('inactive')">
                Inactivas
            </button>

            <button class="px-8 py-3 rounded-xl text-sm font-semibold transition focus:outline-none" [ngClass]="tab === 'add'
        ? 'bg-[#9db091] text-white'
        : 'bg-transparent text-white hover:bg-white/10'" (click)="setTab('add')">
                Agregar
            </button>

        </div>
    </div>


    <!-- Grid Activas -->
    <div *ngIf="tab === 'active'" class="mt-8">

        <!-- Mensaje cuando NO hay activas -->
        <div *ngIf="activePromos.length === 0"
            class="flex h-[40vh] flex-col items-center justify-center text-center text-gray-500">

            <svg xmlns="http://www.w3.org/2000/svg" class="mb-4 h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3M12 6a6 6 0 100 12 6 6 0 000-12z" />
            </svg>

            <p class="text-lg font-semibold">No tienes promociones activas</p>
            <p class="mt-1 text-sm">
                Activa una promoción o crea una nueva desde “Agregar”.
            </p>
        </div>

        <!-- Grid de promociones activas -->
        <div *ngIf="activePromos.length > 0" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">

            <button *ngFor="let p of activePromos" (click)="openModal(p)"
                class="group rounded-2xl bg-white shadow hover:shadow-lg transition overflow-hidden text-left">

                <div class="aspect-[16/10] w-full overflow-hidden bg-gray-100">
                    <img [src]="p.imageUrl" [alt]="p.name"
                        class="h-full w-full object-cover group-hover:scale-[1.02] transition" />
                </div>

                <div class="p-4">
                    <div class="flex items-start justify-between gap-3">
                        <h3 class="font-semibold text-gray-900 line-clamp-2">
                            {{ p.name }}
                        </h3>

                        <span
                            class="shrink-0 rounded-full bg-emerald-100 px-2 py-1 text-xs font-semibold text-emerald-700">
                            Activa
                        </span>
                    </div>

                    <p class="mt-2 text-sm text-gray-600 line-clamp-2">
                        {{ p.description }}
                    </p>
                </div>
            </button>
        </div>

    </div>


    <!-- Grid Inactivas -->
    <div *ngIf="tab === 'inactive'" class="mt-8">

        <!-- Mensaje cuando NO hay inactivas -->
        <div *ngIf="inactivePromos.length === 0"
            class="flex h-[40vh] flex-col items-center justify-center text-center text-gray-500">

            <svg xmlns="http://www.w3.org/2000/svg" class="mb-4 h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 17v-2a4 4 0 118 0v2M7 17h10M12 7v4" />
            </svg>

            <p class="text-lg font-semibold">No tienes promociones inactivas</p>
            <p class="mt-1 text-sm">Cuando desactives una promoción, aparecerá aquí.</p>
        </div>

        <!-- Grid de promociones inactivas -->
        <div *ngIf="inactivePromos.length > 0" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">

            <button *ngFor="let p of inactivePromos" (click)="openModal(p)"
                class="group rounded-2xl bg-white shadow hover:shadow-lg transition overflow-hidden text-left opacity-95">

                <div class="aspect-[16/10] w-full overflow-hidden bg-gray-100">
                    <img [src]="p.imageUrl" [alt]="p.name"
                        class="h-full w-full object-cover grayscale group-hover:grayscale-0 transition" />
                </div>

                <div class="p-4">
                    <div class="flex items-start justify-between gap-3">
                        <h3 class="font-semibold text-gray-900 line-clamp-2">{{ p.name }}</h3>
                        <span class="shrink-0 rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700">
                            Inactiva
                        </span>
                    </div>

                    <p class="mt-2 text-sm text-gray-600 line-clamp-2">{{ p.description }}</p>
                </div>
            </button>
        </div>

    </div>


    <!-- Agregar -->
    <div *ngIf="tab === 'add'" class="mt-8">

        <div class="rounded-2xl bg-white shadow p-6">
            <form class="grid grid-cols-1 gap-5 md:grid-cols-2" [formGroup]="addForm" (ngSubmit)="createPromotion()">

                <!-- File + preview (ocupa 2 columnas) -->
                <div class="md:col-span-2 flex items-start gap-5">
                    <!-- Preview -->
                    <div class="shrink-0">
                        <div
                            class="h-20 w-20 rounded-2xl border border-gray-200 bg-gray-50 overflow-hidden flex items-center justify-center">
                            <img *ngIf="imagePreviewUrl" [src]="imagePreviewUrl" alt="Preview"
                                class="h-full w-full object-cover" />
                            <span *ngIf="!imagePreviewUrl" class="text-[10px] text-gray-400 text-center px-2">
                                Sin imagen
                            </span>
                        </div>
                    </div>

                    <!-- File button + name -->
                    <div class="flex-1">
                        <label class="text-sm font-semibold text-gray-700">Carga la imagen</label>

                        <div class="mt-2 flex items-center gap-4">
                            <input type="file" id="promoImage" accept="image/*" (change)="onAddFileChange($event)"
                                class="hidden" />

                            <label for="promoImage" class="px-5 py-2 rounded-xl text-sm font-semibold cursor-pointer transition
                 bg-[#9db091] text-white hover:bg-[#8aa37f]
                 focus:outline-none focus:ring-2 focus:ring-[#9db091]/50">
                                Cargar imagen
                            </label>

                            <span class="text-sm text-gray-500 truncate">
                                {{ selectedFileName || 'Ningún archivo seleccionado' }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Nombre -->
                <div>
                    <label class="text-sm font-semibold text-gray-700">Nombre</label>
                    <input type="text" formControlName="name" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-3 outline-none transition
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50 focus:border-[#9db091]" />
                </div>

                <!-- Categoría -->
              <!--   <div>
                    <label class="text-sm font-semibold text-gray-700">Categoría</label>
                    <input type="text" formControlName="category" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-3 outline-none transition
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50 focus:border-[#9db091]" />
                </div> -->

                <!-- Descripción -->
                <div class="md:col-span-2">
                    <label class="text-sm font-semibold text-gray-700">Descripción</label>
                    <textarea rows="4" formControlName="description" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-3 outline-none transition
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50 focus:border-[#9db091]"></textarea>
                </div>

                <!-- Fechas -->
                <div>
                    <label class="text-sm font-semibold text-gray-700">Válida desde</label>
                    <input type="date" formControlName="validFrom" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-3 outline-none transition
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50 focus:border-[#9db091]" />
                </div>

                <div>
                    <label class="text-sm font-semibold text-gray-700">Válida hasta</label>
                    <input type="date" formControlName="validTo" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-3 outline-none transition
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50 focus:border-[#9db091]" />
                </div>

                <!-- Activa -->
                <div class="flex items-center gap-2 md:col-span-2">
                    <input type="checkbox" formControlName="active" class="h-4 w-4 rounded border-gray-300 text-[#9db091]
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50">
                    <span class="text-sm text-gray-700">Activa</span>
                </div>

                <!-- Botones -->
                <div class="md:col-span-2 flex justify-end gap-3">
                    <button type="button" class="rounded-xl px-5 py-3 font-semibold text-gray-700 hover:bg-gray-100"
                        (click)="setTab('active')">
                        Cancelar
                    </button>

                    <button type="submit" [disabled]="addForm.invalid || saving" class="px-6 py-3 rounded-xl text-sm font-semibold transition
             bg-[#9db091] text-white hover:bg-[#8aa37f]
             disabled:bg-gray-300 disabled:text-gray-600 disabled:opacity-100 disabled:cursor-not-allowed
             focus:outline-none focus:ring-2 focus:ring-[#9db091]/50">
                        <span class="inline-block">
                            {{ saving ? 'Guardando...' : 'Guardar promoción' }}
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal -->
<div *ngIf="isModalOpen && selected" class="fixed inset-0 z-50">
    <div class="absolute inset-0 bg-black/50" (click)="closeModal()"></div>

    <div class="absolute left-1/2 top-1/2 w-[96vw] max-w-6xl -translate-x-1/2 -translate-y-1/2">
        <div class="rounded-2xl bg-white shadow-xl overflow-hidden">

            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-900">Detalle / Editar</h3>
                <button (click)="closeModal()" class="rounded-lg px-3 py-1.5 hover:bg-gray-100">✕</button>
            </div>

            <!-- BODY -->
            <div class="grid grid-cols-1 md:grid-cols-[40%_60%]">

                <!-- IMAGEN (menos espacio) -->
                <div class="bg-gray-100 flex items-center justify-center p-6">
                    <img [src]="selected.imageUrl" alt="Promo"
                        class="w-2/3 max-h-[320px] object-contain rounded-xl shadow" />
                </div>

                <!-- FORM (más espacio, sin scroll) -->
                <div class="p-6">
                    <form class="space-y-4" [formGroup]="editForm" (ngSubmit)="saveEdit()">

                        <div>
                            <label class="text-sm font-semibold text-gray-700">Cambiar imagen (opcional)</label>
                            <input type="file" accept="image/*" (change)="onEditFileChange($event)" class="mt-2 block w-full text-sm
                       file:mr-4 file:rounded-lg file:border-0
                       file:bg-gray-800 file:px-4 file:py-2
                       file:text-white hover:file:bg-gray-900" />
                        </div>

                        <div>
                            <label class="text-sm font-semibold text-gray-700">Nombre</label>
                            <input formControlName="name"
                                class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2 outline-none focus:ring-2 focus:ring-violet-500" />
                        </div>

                        <div>
                            <label class="text-sm font-semibold text-gray-700">Categoría</label>
                            <input formControlName="category"
                                class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2 outline-none focus:ring-2 focus:ring-violet-500" />
                        </div>

                        <div>
                            <label class="text-sm font-semibold text-gray-700">Descripción</label>
                            <textarea rows="3" formControlName="description"
                                class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2 outline-none focus:ring-2 focus:ring-violet-500"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Desde</label>
                                <input type="date" formControlName="validFrom"
                                    class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2 outline-none focus:ring-2 focus:ring-violet-500" />
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700">Hasta</label>
                                <input type="date" formControlName="validTo"
                                    class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2 outline-none focus:ring-2 focus:ring-violet-500" />
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <label class="inline-flex items-center gap-2">
                                <input type="checkbox" formControlName="active" class="h-4 w-4 rounded border-gray-300">
                                <span class="text-sm text-gray-700">Activa</span>
                            </label>

                            <button type="button" (click)="toggleActiveSelected()"
                                class="rounded-xl px-4 py-2 text-sm font-semibold hover:bg-gray-100">
                                Cambiar estado
                            </button>
                        </div>

                        <div class="flex justify-end gap-3 pt-2">
                            <button type="button" (click)="closeModal()"
                                class="rounded-xl px-5 py-2 font-semibold text-gray-700 hover:bg-gray-100">
                                Cerrar
                            </button>

                            <button type="submit" [disabled]="editForm.invalid || saving"
                                class="rounded-xl bg-[#235000] px-6 py-2 font-semibold text-white hover:bg-violet-700 disabled:opacity-50">
                                {{ saving ? 'Guardando...' : 'Guardar cambios' }}
                            </button>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>
</div>